mixin logged_profile_display(profile, reservations)
  .container-profile.container-fluid
    main.main-profile
      .profile-box
        .main-profile-flex
          // Left Side (Main Profile)
          .left-profile
            if profile.img
              img.profile-pic(src=profile.img alt=`${profile.firstName} ${profile.lastName} avatar`)
            else
              .profile-pic.default-avatar
                span= profile.firstName.charAt(0).toUpperCase() + profile.lastName.charAt(0).toUpperCase()
            h1= profile.firstName + ' ' + profile.lastName
            span.profile-type(class=`type-${profile.type.toLowerCase().replace(' ', '-')}`)= profile.type
            .profile-details
              div
                h4 Biography
                p= profile.biography || 'No biography provided'
            .social-links
              if profile.socialLinks
                if profile.socialLinks.instagram
                  a(href=profile.socialLinks.instagram)
                    img(src="https://img.icons8.com/ios-filled/24/000000/instagram-new.png")
                if profile.socialLinks.facebook
                  a(href=profile.socialLinks.facebook)
                    img(src="https://img.icons8.com/ios-filled/24/000000/facebook-new.png")
                if profile.socialLinks.twitter
                  a(href=profile.socialLinks.twitter)
                    img(src="https://img.icons8.com/ios-filled/24/000000/twitter.png")
                if profile.socialLinks.linkedin
                  a(href=profile.socialLinks.linkedin)
                    img(src="https://img.icons8.com/ios-filled/24/000000/linkedin.png")
          // Right Side (Buttons)
          .right-buttons
            if (user && user.userId && (user.firstName === profile.firstName || user.userType === 'Admin'))
              button.btn.profile-btn(onclick="toggleForm('edit-profile-form')") Edit Profile
            // Edit Forms Section
            .edit-forms-section
            // Edit Profile Form
            .edit-form-container
              form#edit-profile-form.hidden-form(data-profile-id=profile._id)
                h3.edit-form-title Edit Profile
                .form-group
                  label First Name:  
                  input(type="text", name="firstName", value=profile.firstName, required)
                .form-group
                  label Last Name:  
                  input(type="text", name="lastName", value=profile.lastName, required)
                .form-group
                  label Biography:  
                  textarea(name="biography", rows="4")= profile.biography
                .form-actions
                  button(type="submit").btn.btn-primary Save Changes
                  button(type="button" onclick="toggleForm('')").btn.btn-secondary Cancel
      style.
        .edit-forms-section {
          margin-top: 20px;
          width: 100%;
        }
        .edit-form-container {
          border-radius: 8px;
          padding: 20px;
        }
        .reservation-list {
          margin-top: 15px;
          max-height: 500px;
          overflow-y: auto;
        }
        .reservation-item {
          background: #fff;
          border: 1px solid #ddd;
          border-radius: 8px;
          margin-bottom: 10px;
          padding: 12px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .reservation-header {
          display: flex;
          justify-content: space-between;
          margin-bottom: 8px;
        }
        .reservation-lab {
          font-weight: bold;
          color: #11414E;
        }
        .reservation-seat {
          background: #FAEECF;
          padding: 2px 8px;
          border-radius: 4px;
          font-size: 0.9em;
        }
        .reservation-time {
          display: flex;
          flex-direction: column;
          font-size: 0.9em;
          color: #666;
        }
        .reservation-date {
          margin-bottom: 4px;
        }
        .reservation-hours {
          color: #11414E;
        }
        .reservation-students {
          margin-top: 8px;
          font-size: 0.85em;
          color: #666;
          border-top: 1px solid #eee;
          padding-top: 8px;
        }
        .no-reservations {
          text-align: center;
          color: #666;
          padding: 20px;
          font-style: italic;
        }
        .edit-form-title {
          color: #11414E;
          margin-bottom: 20px;
          font-size: 1.5em;
        }
        .form-group {
          margin-bottom: 15px;
        }
        .form-group label {
          display: block;
          margin-bottom: 5px;
          color: #11414E;
        }
        .form-group input,
        .form-group textarea {
          width: 100%;
          padding: 8px;
          border: 1px solid #ddd;
          border-radius: 4px;
          background: white;
        }
        .form-actions {
          display: flex;
          gap: 10px;
          margin-top: 20px;
        }
        .btn-secondary {
          background: #6c757d;
          color: white;
        }
        .hidden-form {
          display: none;
        }
      script.
        function toggleForm(id) {
          document.querySelectorAll('.hidden-form').forEach(f => f.style.display = 'none');
          const form = document.getElementById(id);
          if (form) {
            form.style.display = 'block';
          }
        }

        // Add event listener to the edit profile form
        document.addEventListener('DOMContentLoaded', function() {
          const editForm = document.getElementById('edit-profile-form');
          if (editForm) {
            editForm.addEventListener('submit', handleEditProfileSubmit);
          }
        });

        async function handleEditProfileSubmit(event) {
          event.preventDefault();
          
          const form = event.target;
          const profileId = form.getAttribute('data-profile-id');
          
          if (!profileId || !profileId.match(/^[0-9a-fA-F]{24}$/)) {
            alert('Invalid profile ID');
            return;
          }
          
          const formData = new FormData(form);
          
          try {
            const response = await fetch(`/user/edit/${profileId}`, {
              method: 'PUT',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                firstName: formData.get('firstName'),
                lastName: formData.get('lastName'),
                biography: formData.get('biography')
              })
            });

            const result = await response.json();
            
            if (response.ok) {
              // Success - refresh the page to show updated info
              window.location.reload();
            } else {
              // Show error message
              alert(result.error || 'Failed to update profile');
            }
          } catch (error) {
            console.error('Error updating profile:', error);
            alert('An error occurred while updating the profile');
          }
        }
mixin logged_out_profile_display(profile, reservations)
  .container-profile.container-fluid
    main.main-profile
      .profile-box
        .main-profile-flex
          // Left Side (Main Profile)
          .left-profile
            if profile.img
              img.profile-pic(src=profile.img alt=`${profile.firstName} ${profile.lastName} avatar`)
            else
              .profile-pic.default-avatar
                span= profile.firstName.charAt(0).toUpperCase() + profile.lastName.charAt(0).toUpperCase()
            h1= profile.firstName + ' ' + profile.lastName
            span.profile-type(class=`type-${profile.type.toLowerCase().replace(' ', '-')}`)= profile.type
            .profile-details
              div
                h4 Name Pronunciation
                p= profile.namePronunciation || 'No pronunciation provided'
              div
                h4 Biography
                p= profile.biography || 'No biography provided'
            .social-links
              if profile.socialLinks
                if profile.socialLinks.instagram
                  a(href=profile.socialLinks.instagram)
                    img(src="https://img.icons8.com/ios-filled/24/000000/instagram-new.png")
                if profile.socialLinks.facebook
                  a(href=profile.socialLinks.facebook)
                    img(src="https://img.icons8.com/ios-filled/24/000000/facebook-new.png")
                if profile.socialLinks.twitter
                  a(href=profile.socialLinks.twitter)
                    img(src="https://img.icons8.com/ios-filled/24/000000/twitter.png")
                if profile.socialLinks.linkedin
                  a(href=profile.socialLinks.linkedin)
                    img(src="https://img.icons8.com/ios-filled/24/000000/linkedin.png")
  