extends layout.pug
block content
  - const errorMessage = error || ''
  .login-container
    .image-panel
    .form-panel
      h1 Welcome!
      p Create your new laboratory account to access our facilities
      if errorMessage
        .alert.alert-danger= errorMessage
      form(method="POST", action="/sign-up" onsubmit="return validateForm()")
        .form-group
          input.name-input.form-control(type="text", name="firstName", placeholder="First Name", required)
        .form-group
          input.name-input.form-control(type="text", name="lastName", placeholder="Last Name", required)
        .form-group
          input.form-control(
            type="email",
            name="email",
            placeholder="Email Address",
            pattern=".*@dlsu\\.edu\\.ph$"
            title="Please use your DLSU email (@dlsu.edu.ph)"
            required
          )
        p#password-error.text-danger(style="display: none; margin-bottom: 10px;") Passwords do not match.
        p#requirementsError.text-danger(style="display: none; margin-bottom: 10px;") Password needs to be at least 8 characters and contain at least one special character.
        .form-group#password-group
          input.form-control#password(
            type="password",
            name="password",
            placeholder="Password",
            minlength="8",
            required,
            oninput="checkPasswordRequirements()"
          )
        .form-group#confirm-password-group
          input.form-control#confirmPassword(
            type="password",
            name="confirmPassword",
            placeholder="Confirm Password",
            required,
            oninput="checkPasswords()"
          )
        .submit-fields.mt-3
          .buttn
            button.btn.main-btn#submit-btn(type="submit") Sign Up
          p.signup.mt-2
            | Already have an account?
            a(href="/log-in")    Login
  script.
    function checkPasswordRequirements() {
      const password = document.getElementById('password').value;
      const requirementsError = document.getElementById('requirementsError');
      const passwordGroup = document.getElementById('password-group');
      const submitBtn = document.getElementById('submit-btn');
      
      // Check password requirements
      const minLength = password.length >= 8;
      const hasSpecialChar = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);
      const meetsRequirements = minLength && hasSpecialChar;
      
      if (password !== '' && !meetsRequirements) {
        requirementsError.style.display = 'block';
        passwordGroup.style.border = '2px solid red';
        submitBtn.disabled = true;
      } else {
        requirementsError.style.display = 'none';
        passwordGroup.style.border = '';
        // Only enable submit button if passwords also match
        checkPasswords();
      }
    }
    
    function checkPasswords() {
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const errorElement = document.getElementById('password-error');
      const submitBtn = document.getElementById('submit-btn');
      const passwordGroup = document.getElementById('password-group');
      const confirmPasswordGroup = document.getElementById('confirm-password-group');
      
      // Check if passwords match
      const passwordsMatch = password === confirmPassword;
      const bothFieldsFilled = password !== '' && confirmPassword !== '';
      
      // Check password requirements
      const minLength = password.length >= 8;
      const hasSpecialChar = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);
      const meetsRequirements = minLength && hasSpecialChar;
      
      if (bothFieldsFilled && !passwordsMatch) {
        errorElement.style.display = 'block';
        passwordGroup.style.border = '2px solid red';
        confirmPasswordGroup.style.border = '2px solid red';
        submitBtn.disabled = true;
      } else {
        errorElement.style.display = 'none';
        confirmPasswordGroup.style.border = '';
        
        // Only remove red border from password field if it meets requirements
        if (meetsRequirements || password === '') {
          passwordGroup.style.border = '';
        }
        
        // Only enable submit button if both conditions are met
        if (passwordsMatch && meetsRequirements && bothFieldsFilled) {
          submitBtn.disabled = false;
        } else {
          submitBtn.disabled = true;
        }
      }
    }
    
    function validateForm() {
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      
      // Check password requirements
      const minLength = password.length >= 8;
      const hasSpecialChar = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);
      const passwordsMatch = password === confirmPassword;
      
      // Final validation check
      if (!minLength || !hasSpecialChar || !passwordsMatch) {
        return false;
      }
      
      return true;
    }